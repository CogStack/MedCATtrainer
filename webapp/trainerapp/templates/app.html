{% extends 'base.html' %}
{% load staticfiles %}
{% load js %}

{% block style %}
  <link rel="stylesheet" href="{% static 'css/app.css' %}">
{% endblock %}

{% block body %}
  <div id="app" class="container-fluid app-container">
    <div class="app-header">
      <h4>{{ title }} Training Samples</h4>
      <h5 class="file-name-heading">Editing File:
        <span class="file-name">{{ data.f_name }}</span>
        |
        <span class="file-name">{{ data.f_names | length }} Docs Remaining</span>
      </h5>
      <button class="help btn btn-default" @click="helpModal = true"><i class="fa fa-question-circle fa-lg"></i></button>
    </div>
    <div class="app-main">
      <sidebar :text="text" :items="items" :tasks="tasks"
               :task-idx="current.taskIndex"
               :span-idx="current.spanIndex"
               :select-item="selectItem"></sidebar>
      <div class="handle">
        <i class="fas fa-grip-lines-vertical handle-icon"></i>
      </div>
      <clinical-text :text="text" :span="current.span"
                     :task="tasks[current.taskIndex]"
                     :select-item="selectItem"
                     :all-spans="items"
                     class="border-top"
                     id="mainTextArea"></clinical-text>
    </div>
    <div class="app-footer">
      <task-bar :tasks="tasks" :current-task="current.task" :select="markItem"></task-bar>
      <nav-bar :tasks-complete="tasksComplete"
        :current="current" :total-tasks="tasks.length" :total-spans="items.length"
        :next="next" :back="back" :submit="submit" :mark-incomplete="incomplete"></nav-bar>
    </div>
    <modal v-if="saveModal">
      <h3 slot="header" class="text-success">Save Successful</h3>
      <div slot="body"></div>
      <div slot="footer">
        <button class="btn btn-primary" @click="reload()">Next Document</button>
      </div>
    </modal>

    <modal v-if="failModal">
      <h3 slot="header" class="text-danger">Save Failed</h3>
      <div slot="body">
        Please contact cat-trainer-dev team for further investigation
      </div>
    </modal>

    <modal v-if="helpModal" class="help-modal">
      <h3 slot="header">{{ title }} Tagging Help</h3>
      <div slot="body" class="help-modal-body">
          <help-modal :descriptions="taskDescriptions"></help-modal>
      </div>
      <div slot="footer">
        <button class="btn btn-primary" @click="helpModal = false">Close</button>
      </div>
    </modal>

    <modal v-if="errorModal">
      <h3 slot="header" class="text-danger">Failed To Load Next Tagged File</h3>
      <div slot="body">
        <p>No files found to annotate and tag.</p>
        <p>Either upload more files to tag</p>
        <p>Or tagged and annotated files from the home screen.</p>
      </div>
      <div slot="footer">
        <a href="/"><button class="btn btn-primary">CAT Home</button></a>
      </div>
    </modal>
  </div>

  <script src="{% static 'deps/js.cookie.min.js' %}"></script>
  <script src="{% static 'deps/vue.js' %}"></script>
  <script src="{% static 'deps/underscore-min.js' %}"></script>
  <script src="{% static 'deps/vue-resource@1.5.1' %}"></script>

  <script type="text/javascript">
    taskTrainingData = function() {
      let trainingData = {
        data: {{ data | js }},
        tasks: {{ tasks | js }},
        taskDescriptions: {{ taskDescriptions | js }}
      };
      return JSON.parse(JSON.stringify(trainingData));
    };
  </script>
  <script src="{% static 'js/app.js' %}"></script>

{% endblock %}
